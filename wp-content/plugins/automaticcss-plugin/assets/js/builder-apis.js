import{getTypeOfCssProperty,waitForEl,toCamelCase,toKebapCase}from"./helpers.js";let sharedFunctions={previewClass:function(e){var t=this.getCurrentElementId();this.getIframeDocument().querySelector(t).classList.add(e)},removePreviewClass:function(e){var t=this.getCurrentElementId();this.isClassAlreadyActive(e)||this.getIframeDocument().querySelector(t).classList.remove(e)},getActiveClassesAsArray:function(){return this.getIframeDocument().querySelector(this.getCurrentElementId()).classList.value.split(" ")},sanitizeElementLabel(t){if(t){let e=t;return(e=(e=(e=(e=e.replace(/\([^\)]*\)/g,"")).replace(/\[[^\]]*\]/g,"")).replace(/[^a-zA-z0-9-_ ]/g,"")).replace(/\s+/g," ")).trim()}}},bricksFunctions={name:"bricks",mainInputSelector:"div.active-class",mainPanelSelector:"#bricks-panel-inner",classInputSelector:"#bricks-panel-element-classes > div.bricks-control-popup.bottom > div.input-wrapper > input[type=text]",saveClassSelector:".input-wrapper .actions .create",findUnusedClass:function(e){var t=this.getUnusedClassListItems();if(null!=t)for(var r of t)if(r.firstElementChild?.textContent==e)return r;return null},sanitizeCssProperty:(e,t)=>{switch(e){case"_width":return"width";case"_height":return"height";case"_widthMin":return"min-width";case"_heightMin":return"min-height";case"_widthMax":return"max-width";case"_heightMax":return"max-height";case"_top":return"top";case"_right":return"right";case"_bottom":return"bottom";case"_left":return"left";case"width-0":return"border-top-width";case"width-1":return"border-right-width";case"width-2":return"border-bottom-width";case"width-3":return"border-left-width";case"radius-0":return"border-top-left-radius";case"radius-1":return"border-top-right-radius";case"radius-2":return"border-bottom-right-radius";case"radius-3":return"border-bottom-left-radius";case"_typography":return"color";case"_background":return"background-color";case"_border":return"border-color";case"_columnGap":return"column-gap";case"_rowGap":return"row-gap";case"_gradient":return"";case"_border":return"border-color";case"_gridTemplateColumns":return"grid-template-columns";case"_gridGap":return"grid-gap";case"_gridTemplateRows":return"grid-template-rows";case"radius-top":return"border-top-left-radius";case"radius-right":return"border-top-right-radius";case"radius-left":return"border-bottom-left-radius";case"radius-bottom":return"border-bottom-right-radius";default:return"_"==e.charAt(0)?"":e}},getCurrentCssProperty:function(e){let t="";var r=e?.parentElement?.parentElement.classList.contains("handle")?e?.parentElement?.parentElement:null;return r&&r.title?t=r.title:e.parentElement.parentElement.querySelector("label[for]")&&!e.classList.contains("has-dynamic-picker")&&"raw"!==e.parentElement.parentElement.querySelector("label[for]").getAttribute("for").slice(0,3)?t=e.parentElement.parentElement.querySelector("label[for]").getAttribute("for"):e.closest("[controlkey]")?"radius"==(t=e.closest("[controlkey]").getAttribute("controlkey")??"")&&(t="radius-"+e.closest(".handle").classList[1]??""):e.closest(".control-group")&&(t=e.closest(".control-group").querySelector("[data-controlkey]").getAttribute("data-controlkey")??""),this.sanitizeCssProperty(t,e)},initHoverPreviewEventImplementation:function(t){document.querySelector("#bricks-panel-inner").addEventListener("mouseup",e=>{null!==e.target.closest(this.mainInputSelector)&&0==e.button&&waitForEl(this.classInputSelector).then(()=>{t(),document.querySelector(this.classInputSelector).addEventListener("input",function(){var e=document.querySelector(".css-classes ul:last-child li");null!=e&&"0"!==e.getAttribute("tabindex")&&t()})})});function e(e){if("Enter"==e.key){let e=()=>{null!=document.querySelector(this.classInputSelector)?(t(),document.querySelector(this.classInputSelector).addEventListener("input",function(){var e=document.querySelector(".css-classes ul:last-child li");null!=e&&"0"!==e.getAttribute("tabindex")&&t()})):setTimeout(e,100)};null==document.querySelector(this.classInputSelector)&&setTimeout(e,100)}}document.addEventListener("keydown",e),this.getIframeDocument().addEventListener("keydown",e)},getExcludedInputSelectors:function(){return"#title, #url, #ariaLabel, #rel, #text, #bricks-panel-search, .external-url, #videoUrl, #cssSelector, #_cssClasses, #_cssId, div[data-control='conditions']"},removeValuePreview:function(e,t){t.innerHTML=""},setValue:function(e,t){t.value=e,t.dispatchEvent(new Event("input"))},displayValuePreview:function(e,t,r){var n=this.getCurrentCssProperty(t),s=this.getCurrentSelector();n?r.innerHTML=s+` {${n}: ${e}}`:(t.value=e,t.dispatchEvent(new Event("input")))},setUnitToNone:function(e){},addStructurePanelButton:async function(n={icon:"BEM",onClick:()=>{}}){document.querySelector("#bricks-structure").addEventListener("mouseover",t=>{t=t.target.closest(".structure-item");if(t&&!t.querySelector(".bem-generator")&&1!==t.parentElement.querySelectorAll(".structure-item").length){var r=document.createElement("li");r.innerHTML=n.icon,r.querySelector("svg").setAttribute("style","width: 18px"),r.style.width="24px",r.style.top="3px",r.classList.add("action","bem-generator"),r.addEventListener("click",e=>{var t=e.target.closest(".structure-item").parentElement.dataset.id;n.onClick(e,t)});let e=t.querySelector(".actions");e||((e=document.createElement("ul")).classList.add("actions"),t.insertBefore(e,t.querySelector(".element-states"))),e.insertBefore(r,e.firstChild)}})},changeLabelOfElement:function(e,t){t=this._getElementById(t);if(t&&e)return t.label=e,!0},copyStylesFromClass(e,t){e=this._getBricksGlobalClassByName(e),t=this._getBricksGlobalClassByName(t);e||t||alert("Copying styles failed: Source and target classes do not exist"),t||alert("Copying styles failed: Target class does not exist"),e?.settings&&(t.settings=JSON.parse(JSON.stringify(e.settings))),e?.settings._cssCustom&&(t.settings._cssCustom=this._getBricksInternalFunctions().$_replaceCustomCssRoot(e.name,t.name,t.settings._cssCustom))},removeClass:function(e){var t=this._getActiveElement().id;this.removeClassFromElement(e,t)},addClass:function(e){this.removePreviewClass(e);var t=this._getActiveElement().id;this.addClassToElement(e,t)},renameClass:function(e,t){var r=this._getBricksGlobalClassByName(e);r&&(r?.settings?._cssCustom&&(r.settings._cssCustom=this._getBricksInternalFunctions().$_replaceCustomCssRoot(e,t,r.settings._cssCustom)),r.name=t)},rerenderStyles:function(){this._getBricksState().globalClasses.push({}),setTimeout(()=>{this._getBricksState().globalClasses.pop()},100)},removeClassFromElement:function(e,t){var t=this._getElementById(t),r=t.settings._cssGlobalClasses,e=this._getBricksGlobalClassByName(e)?.id;t&&r&&-1!==r.indexOf(e)&&r.splice(r.indexOf(e),1)},deleteClassFromBuilder:function(e){const t=this._getBricksGlobalClassByName(e)?.id;t&&(e=this._getBricksState().globalClasses).splice(e.findIndex(e=>e.id===t),1)},addClassToElement:function(n,s){s=this._getElementById(s);if(s){var o,i=this._getBricksState();let e=s?.settings?._cssGlobalClasses,t=!1,r=l();return i.globalClasses.forEach(e=>{e.name===n?(t=!0,r=e.id):e.id===r&&(r=l())}),t||(o={id:r,name:n,settings:{}},i.globalClasses.push(o)),e||(s.settings||(s.settings={}),s.settings._cssGlobalClasses=[],e=s.settings._cssGlobalClasses),e?.includes(r)||e.push(r),!0;function l(){return(Math.random()+1).toString(36).slice(-6)}}},isClassAlreadyActive:function(e){e=this._getBricksGlobalClassByName(e);return!!e&&this._getActiveElement().settings._cssGlobalClasses?.includes(e)},_getBricksGlobalClassById:function(e){var t=this._getBricksState();return t.globalClasses[t.globalClassIndexById[e]]},_getBricksGlobalClassByName:function(t){return this._getBricksState().globalClasses.find(e=>e.name===t)},_getBricksInternalFunctions:function(){return document.querySelector("[data-v-app]").__vue_app__.config.globalProperties},_getBricksState(){return document.querySelector("[data-v-app]").__vue_app__.config.globalProperties.$_state},_getBricksElements:function(){var e=this._getBricksState();return e.content.concat(e.header).concat(e.footer)},_getElementById:function(t){return this._getBricksElements().find(e=>e.id===t)},_getActiveElement:function(){return this._getBricksState().activeElement},_getBricksClassNamesFromIdArray:function(e){if(!e)return e;let t=[];return e.forEach(e=>{e=this._getBricksGlobalClassById(e)?.name;e&&t.push(e)}),t},getIframeDocument:function(){return document.getElementById("bricks-builder-iframe").contentWindow.document},getElementIdFromStructurePanelButton:function(e){},getActiveElementInternalId:function(){return this._getActiveElement().id},getElementTree:function(e){var e=this._getElementById(e),t={};t.options={id:e.id,value:toKebapCase(this.sanitizeElementLabel(e.label)||this.sanitizeElementLabel(e.name)),label:e.label||e.name.charAt(0).toUpperCase()+e.name.slice(1),cssClasses:this._getBricksClassNamesFromIdArray(e.settings._cssGlobalClasses)};let n=e=>{if(e){const r=[];return e.forEach(e=>{var t=this._getElementById(e);r.push({options:{id:e,value:toKebapCase(this.sanitizeElementLabel(t.label)||this.sanitizeElementLabel(t.name)),label:t.label??t.name.charAt(0).toUpperCase()+t.name.slice(1),cssClasses:this._getBricksClassNamesFromIdArray(t.settings._cssGlobalClasses)},children:n(t.children)})}),r}};return t.children=n(e.children),t},getElementLabel:function(e){e=this._getElementById(e);return e.label||e.name.charAt(0).toUpperCase()+e.name.slice(1)},getClassStringFromListItem:function(e){return"."===e.firstElementChild.textContent.charAt(0)?e.firstElementChild.textContent.slice(1):e.firstElementChild.textContent},getCurrentElementId:function(){var e=this._getActiveElement(),t=e.settings._cssId;return t?"#"+t:"#brxe-"+e.id},getCurrentInputOption:function(e){var t=e.closest("[controlkey]")?e.closest("[controlkey]").getAttribute("controlkey"):null;return t&&""!=t?t:this.getCurrentCssProperty(e)},getCurrentSelector:function(){var e=document.querySelector(this.mainInputSelector)?.querySelector("input")?.getAttribute("value");return e||document.querySelector(this.mainInputSelector)?.querySelector("input")?.getAttribute("placeholder")},getUnusedClassListItems:function(){let e=document.querySelectorAll(".css-classes ul:last-child li");return 0===e.length&&(document.querySelector(this.mainInputSelector)?.click(),e=document.querySelectorAll(".css-classes ul:last-child li")),e},getCurrentInput:function(e){return e}},oxygenFunctions={name:"oxygen",getIframeDocument:()=>document.getElementById("ct-artificial-viewport").contentWindow.document,mainInputSelector:".oxygen-active-selector-box",mainPanelSelector:"#oxygen-sidebar",classInputSelector:".oxygen-classes-dropdown-input",saveClassSelector:".input-wrapper .actions .create",displayValuePreview:function(e,t,r){t.value=e,t.dispatchEvent(new Event("input"))},removeValuePreview:function(e,t){e.value="",e.dispatchEvent(new Event("input"))},setValue:function(e,t){t.value=e,t.dispatchEvent(new Event("input"))},setUnitToNone:function(e){var t=this.getCurrentInputOption(e);e.parentElement.querySelector(".oxygen-measure-box-units")&&t&&$scope.iframeScope.setOptionUnit(t," ")},rerenderStyles:function(){},addStructurePanelButton:async function(r){document.querySelector("#ct-sidepanel").addEventListener("mouseover",e=>{var t,e=e.target.closest(".dom-tree-node");e&&!e.querySelector(".bem-generator")&&0!==e.querySelectorAll(".dom-tree-node").length&&((t=document.createElement("span")).innerHTML=r.icon,t.style.height="18px",t.style.width="18px",t.classList.add("action","bem-generator"),t.addEventListener("click",e=>{var t=e.target.closest(".dom-tree-node").getAttribute("ng-attr-tree-id");r.onClick(e,t)}),(e=e.querySelector(".dom-tree-node-options")).insertBefore(t,e.firstChild))})},changeLabelOfElement:function(e,t){t=this._getElementById(t);if(t&&e)return t.options.nicename=e,!0},setActiveSelector(e,t){this._getElementById(t).options.activeselector=e,$scope.iframeScope.switchEditToId()},copyStylesFromClass(e,t){let r;(r=$scope.iframeScope.classes[e]?$scope.iframeScope.getClassOptionsToCopy(e):r)&&($scope.iframeScope.classes[t]=r,$scope.iframeScope.classesCached=!1,$scope.iframeScope.outputCSSOptions())},removeClass:function(e){$scope.iframeScope.removeComponentClass(e)},addClass:function(e){this.removePreviewClass(e),$scope.iframeScope.addSuggestedClassToComponent(e)},renameClass:function(e,t){alert("Rename in Oxygen is not possible")},removeClassFromElement:function(e,t){$scope.iframeScope.removeComponentClass(e,t)},deleteClassFromBuilder:function(e){$scope.iframeScope.deleteClass(e)},addClassToElement:function(e,t){$scope.iframeScope.addClassToComponentSafe(t,e),this.setActiveSelector(e,t)},isClassAlreadyActive:function(e){if($scope.iframeScope.findComponentItem($scope.iframeScope.componentsTree.children,$scope.iframeScope.component.active.id,$scope.iframeScope.getComponentItem).options.classes)return $scope.iframeScope.findComponentItem($scope.iframeScope.componentsTree.children,$scope.iframeScope.component.active.id,$scope.iframeScope.getComponentItem).options.classes.includes(e)},_getElementById:function(e){return $scope.iframeScope.findComponentItem($scope.iframeScope.componentsTree.children,e,$scope.iframeScope.getComponentItem)},_sanitizeElementLabel(e){return e.replace(/[^a-zA-z0-9-_]/g,"")},getElementTree:function(e){var t=this._getElementById(e),r={};r.options={id:t.id,value:toKebapCase(this.sanitizeElementLabel(t.options.nicename)),label:t.options.nicename,cssClasses:t.options?.classes??[]};let n=e=>{if(e){let t=[];return e.forEach(e=>{t.push({options:{id:e.id,value:toKebapCase(this.sanitizeElementLabel(e.options.nicename)),label:e.options.nicename,cssClasses:e.options?.classes??[]},children:n(e.children)??[]})}),t}};return r.children=n($scope.iframeScope.getElementChildren(e)),r},getElementLabel:function(e){return this._getElementById(e).options.nicename},getCurrentElementId:function(){return"#"+$scope.iframeScope.findComponentItem($scope.iframeScope.componentsTree.children,$scope.iframeScope.component.active.id,$scope.iframeScope.getComponentItem).options.selector},initHoverPreviewEventImplementation:e=>{document.querySelector(".oxygen-classes-dropdown-input").addEventListener("input",function(){null!=document.querySelector(".oxygen-classes-suggestions > li:first-child")&&e()})},getUnusedClassListItems:function(){return document.querySelectorAll(".oxygen-classes-suggestions > li")},getClassStringFromListItem:function(e){return e.lastElementChild.textContent},getCurrentInputOption:e=>{var t=e.getAttribute("data-option");return null!=t?t:!(!e.previousElementSibling||!e.previousElementSibling.classList.contains("oxygen-color-picker-color"))&&"color"},getCurrentInput:function(e){return e},getCurrentSelector:function(){return!1},getCurrentCssProperty:function(e){return!1},getExcludedInputSelectors:function(){return".oxygen-file-input"}},gutenbergFunctions={name:"gutenberg",getIframeDocument:()=>document.querySelector("iframe[name='editor-canvas']")?document.querySelector("iframe[name='editor-canvas']").contentWindow.document:document.querySelector(".edit-post-visual-editor__content-area"),mainInputSelector:".acss-class-input input",mainPanelSelector:".interface-navigable-region.interface-interface-skeleton__sidebar",classInputSelector:".acss-class-input input",getCurrentElementId:function(){return"#block-"+wp.data.select("core/block-editor").getSelectedBlock().clientId},addClass:function(e){this.removePreviewClass(e);var t=wp.data.select("core/block-editor").getSelectedBlock(),e={...t.attributes,className:(`${t.attributes.className??""} `+e).trim()};wp.data.dispatch("core/block-editor").updateBlockAttributes(t.clientId,e)},removeClass:function(e){var t=wp.data.select("core/block-editor").getSelectedBlock(),r=t.attributes.className,e=new RegExp("\\b\\s*"+e+"\\s*\\b","g"),r=r.replace(e,"").trim(),e={...t.attributes,className:""+r};wp.data.dispatch("core/block-editor").updateBlockAttributes(t.clientId,e)},isClassAlreadyActive:function(e){return(wp.data.select("core/block-editor").getSelectedBlock().attributes.className?.split(" ")??[]).includes(e)},getCurrentInputOption:()=>!1,setUnitToNone:()=>{},initHoverPreviewEventImplementation:e=>{},getCurrentInput:function(e){return e},getCurrentSelector:function(){return this.getCurrentElementId()},getCurrentCssProperty:function(e){if(!e.classList.contains("gblocks-color-component__toggle-indicator"))return"gblocks-"===e.id.slice(0,8)?toKebapCase(toCamelCase(e.id.slice(8))):toKebapCase(toCamelCase(e.id));var t=e.closest(".gblocks-color-component");if(e.closest(".gblocks-border-colors"))return r=e.closest(".gblocks-flex-control").querySelector(".components-text-control__input").id.match(/border([a-zA-Z]+)-/)[1].toLowerCase(),t.previousElementSibling?.classList.contains("gblocks-color-component")?`border-${r}-color-hover`:`border-${r}-color`;var r=e.closest(".gblocks-color-group__row"),e=r?.querySelector(".gblocks-color-group__row-label")?.textContent;if(e&&r){if(t.previousElementSibling?.classList.contains("gblocks-color-component"))switch(e){case"Background":return"background-color-hover";case"Text":return"color-hover";case"Link":return"link-color-hover"}switch(e){case"Background":return"background-color";case"Text":return"color";case"Link":return"link-color"}}return!1},getExcludedInputSelectors:function(){return"#thisisjustaplaceholder"},getVarSections:function(e){switch(getTypeOfCssProperty(this.getCurrentCssProperty(e))){case"typography":return["typography"];case"spacing":return["spacing","section","button","frames-card"];case"radius":return["radius","button","frames-card"];case"width":return["width"];case"grid":return["grid"];case"colors":return["colors"];case"height":return["height"];default:return[""]}},getCategoryFromCssProperty:function(){const t=new Map;return["font-size","font-family","font-weight","line-height","letter-spacing"].forEach(e=>t.set(e,"typography")),["border-top-left-radius","border-bottom-left-radius","border-top-right-radius","border-bottom-right-radius","border-top-width","border-left-width","border-bottom-width","border-right-width","border-top-color","border-left-color","border-bottom-color","border-right-color","border-top-color-hover","border-left-color-hover","border-bottom-color-hover","border-right-color-hover"].forEach(e=>t.set(e,"borders")),["margin-top","margin-left","margin-right","margin-bottom","padding-top","padding-left","padding-right","padding-bottom"].forEach(e=>t.set(e,"spacing")),["width","height","min-width","min-height","max-height","max-width"].forEach(e=>t.set(e,"sizing")),["color","background-color","link-color","color-hover","background-color-hover","link-color-hover"].forEach(e=>t.set(e,"colors")),function(e){return t.get(e)}}(),setCssProperty:function(e,t){var r=wp.data.select("core/block-editor").getSelectedBlock(),n=this.getCategoryFromCssProperty(e);let s={...r.attributes};var o=document.querySelector(".gb-responsive-tabs");let i="";o?.querySelector("button.is-pressed:nth-child(2)")?i="Tablet":o?.querySelector("button.is-pressed:nth-child(3)")&&(i="Mobile"),e+=i,"colors"===n?("color"===e&&(e="textColor"),s={...r.attributes,[toCamelCase(e)]:t}):s[n]={...r.attributes[n],[toCamelCase(e)]:t},wp.data.dispatch("core/block-editor").updateBlockAttributes(r.clientId,s)},displayValuePreview:function(e,t,r){var n=this.getCurrentSelector();let s=this.getCurrentCssProperty(t);s&&("hover"===s.slice(-5)&&(s=s.slice(0,s.length-6)),r.innerHTML=`${n} {${s}: ${e}}`)},removeValuePreview:function(e,t){t.innerHTML=""},setValue:function(e,t){t=this.getCurrentCssProperty(t);this.setCssProperty(t,e)}},builderFunctions={},Builder=(builderFunctions=document.getElementById("ct-artificial-viewport")?oxygenFunctions:document.querySelector(".brx-body")?bricksFunctions:gutenbergFunctions,window.builderTest={...sharedFunctions,...builderFunctions},{...sharedFunctions,...builderFunctions});export{Builder};